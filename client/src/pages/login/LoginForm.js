import React, { useState, useEffect } from "react";
import styled from "styled-components";

import { login } from "slices/auth";
import { clearMessage } from "slices/message";
import { useDispatch, useSelector } from "react-redux";

import { FcGoogle } from "react-icons/fc";
import { SiFacebook } from "react-icons/si";
import TextInput from "components/TextInput";

function LoginForm(props) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const { message } = useSelector((state) => state.messageState);
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(clearMessage());
  }, [dispatch]);

  const isMobile = props.mobile;

  const handleSubmit = (e) => {
    e.preventDefault();
    // setLoading(true);
    dispatch(login({ email, password }))
      .unwrap()
      .then(() => {
        props.history.push("/home");
        window.location.reload();
      })
      .catch(() => {
        setPassword("");
      });
  };

  return (
    <FormWrapper isMobile={isMobile}>
      {message && (
        <div>
          <div role="alert">{message}</div>
        </div>
      )}
      <TextInput
        placeholder="Email"
        type={"email"}
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        onCancel={() => setEmail("")}
      />
      <TextInput
        placeholder="Password"
        type={"password"}
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        onCancel={() => setPassword("")}
      />
      <FormBottom>
        <Forgot>Forgot your password?</Forgot>
        <Button type={"submit"} onClick={handleSubmit} isMobile={isMobile}>
          Login
        </Button>
      </FormBottom>
      <ContinueWith />
      <LoginWithButton type={"button"}>
        <LoginWithWrapper>
          <FcGoogle size={30} />
          <LoginWithText>Login with Google</LoginWithText>
        </LoginWithWrapper>
      </LoginWithButton>
      <LoginWithButton type={"button"}>
        <LoginWithWrapper>
          <SiFacebook size={30} color="#3975EA" />
          <LoginWithText>Login with Facebook</LoginWithText>
        </LoginWithWrapper>
      </LoginWithButton>
    </FormWrapper>
  );
}

const FormWrapper = styled.form`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  ${(props) =>
    props.isMobile && "width: 100%; max-width: 400px; margin: 0 auto;"}
`;

const Input = styled.input`
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 16px 16px 16px 24px;
  width: 100%;
  height: 56px;
  background: #ece3ff;
  border: 0;
  &:focus {
    outline: none;
    border: 1px solid #8c52ff;
  }
  font-size: 16px;
  box-sizing: border-box;
  border-radius: 8px;
  margin-bottom: 11px;
`;

const FormBottom = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
`;

const Forgot = styled.div`
  font-family: "Roboto";
  font-weight: regular;
  font-size: 14px;
  line-height: 16px;
  text-decoration-line: underline;
  color: #1f0045;
  margin-bottom: 24px;
  cursor: pointer;
  align-self: flex-end;
`;

const Button = styled.button`
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  ${(props) => (props.isMobile ? "width: 100%;" : "width: 319px;")}
  height: 48px;
  background: #8c52ff;
  box-shadow: -5px 5px 22px rgba(140, 82, 255, 0.5);
  border-radius: 8px;
  border: none;
  font-family: "Roboto";
  font-weight: bold;
  font-size: 14px;
  line-height: 16px;
  color: #ffffff;
  margin: 0px 10px;
  cursor: pointer;
`;

const ContinueWith = () => (
  <svg
    width="291"
    height="14"
    style={{ margin: "24px 0px" }}
    viewBox="0 0 291 14"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <line y1="6.5" x2="96" y2="6.5" stroke="#BBBBBB" />
    <line x1="195" y1="6.5" x2="291" y2="6.5" stroke="#BBBBBB" />
    <path
      d="M104.533 7.92969V7.73633C104.533 7.27539 104.6 6.84961 104.732 6.45898C104.865 6.06836 105.055 5.73047 105.301 5.44531C105.551 5.16016 105.85 4.93945 106.197 4.7832C106.545 4.62305 106.932 4.54297 107.357 4.54297C107.787 4.54297 108.176 4.62305 108.523 4.7832C108.871 4.93945 109.17 5.16016 109.42 5.44531C109.67 5.73047 109.861 6.06836 109.994 6.45898C110.127 6.84961 110.193 7.27539 110.193 7.73633V7.92969C110.193 8.39062 110.127 8.81641 109.994 9.20703C109.861 9.59375 109.67 9.92969 109.42 10.2148C109.174 10.5 108.877 10.7227 108.529 10.8828C108.182 11.0391 107.795 11.1172 107.369 11.1172C106.939 11.1172 106.551 11.0391 106.203 10.8828C105.855 10.7227 105.557 10.5 105.307 10.2148C105.057 9.92969 104.865 9.59375 104.732 9.20703C104.6 8.81641 104.533 8.39062 104.533 7.92969ZM105.23 7.73633V7.92969C105.23 8.27734 105.277 8.60742 105.371 8.91992C105.465 9.22852 105.602 9.50391 105.781 9.74609C105.961 9.98438 106.184 10.1719 106.449 10.3086C106.715 10.4453 107.021 10.5137 107.369 10.5137C107.713 10.5137 108.016 10.4453 108.277 10.3086C108.543 10.1719 108.766 9.98438 108.945 9.74609C109.125 9.50391 109.26 9.22852 109.35 8.91992C109.443 8.60742 109.49 8.27734 109.49 7.92969V7.73633C109.49 7.39258 109.443 7.06641 109.35 6.75781C109.26 6.44922 109.123 6.17383 108.939 5.93164C108.76 5.68945 108.537 5.49805 108.271 5.35742C108.006 5.2168 107.701 5.14648 107.357 5.14648C107.014 5.14648 106.709 5.2168 106.443 5.35742C106.182 5.49805 105.959 5.68945 105.775 5.93164C105.596 6.17383 105.459 6.44922 105.365 6.75781C105.275 7.06641 105.23 7.39258 105.23 7.73633ZM112.344 5.70898V11H111.646V4.66016H112.326L112.344 5.70898ZM114.588 4.61328L114.57 5.25781C114.492 5.24609 114.416 5.23633 114.342 5.22852C114.268 5.2207 114.188 5.2168 114.102 5.2168C113.797 5.2168 113.529 5.27344 113.299 5.38672C113.072 5.49609 112.881 5.65039 112.725 5.84961C112.568 6.04492 112.449 6.27539 112.367 6.54102C112.285 6.80273 112.238 7.08398 112.227 7.38477L111.969 7.48438C111.969 7.07031 112.012 6.68555 112.098 6.33008C112.184 5.97461 112.314 5.66406 112.49 5.39844C112.67 5.12891 112.895 4.91992 113.164 4.77148C113.438 4.61914 113.758 4.54297 114.125 4.54297C114.215 4.54297 114.303 4.55078 114.389 4.56641C114.479 4.57812 114.545 4.59375 114.588 4.61328ZM120.957 10.5137C121.254 10.5137 121.531 10.459 121.789 10.3496C122.051 10.2363 122.266 10.0703 122.434 9.85156C122.605 9.62891 122.703 9.35742 122.727 9.03711H123.395C123.375 9.43945 123.252 9.79883 123.025 10.1152C122.803 10.4277 122.51 10.6738 122.146 10.8535C121.787 11.0293 121.391 11.1172 120.957 11.1172C120.516 11.1172 120.125 11.0371 119.785 10.877C119.449 10.7168 119.168 10.4941 118.941 10.209C118.715 9.91992 118.543 9.58398 118.426 9.20117C118.312 8.81445 118.256 8.39844 118.256 7.95312V7.70703C118.256 7.26172 118.312 6.84766 118.426 6.46484C118.543 6.07812 118.715 5.74219 118.941 5.45703C119.168 5.16797 119.449 4.94336 119.785 4.7832C120.121 4.62305 120.51 4.54297 120.951 4.54297C121.404 4.54297 121.811 4.63477 122.17 4.81836C122.533 5.00195 122.822 5.26172 123.037 5.59766C123.256 5.93359 123.375 6.33203 123.395 6.79297H122.727C122.707 6.45312 122.617 6.16016 122.457 5.91406C122.297 5.66797 122.086 5.47852 121.824 5.3457C121.562 5.21289 121.271 5.14648 120.951 5.14648C120.592 5.14648 120.285 5.2168 120.031 5.35742C119.777 5.49414 119.57 5.68359 119.41 5.92578C119.254 6.16406 119.139 6.4375 119.064 6.74609C118.99 7.05078 118.953 7.37109 118.953 7.70703V7.95312C118.953 8.29297 118.988 8.61719 119.059 8.92578C119.133 9.23047 119.248 9.50195 119.404 9.74023C119.564 9.97852 119.771 10.168 120.025 10.3086C120.283 10.4453 120.594 10.5137 120.957 10.5137ZM124.42 7.92969V7.73633C124.42 7.27539 124.486 6.84961 124.619 6.45898C124.752 6.06836 124.941 5.73047 125.188 5.44531C125.438 5.16016 125.736 4.93945 126.084 4.7832C126.432 4.62305 126.818 4.54297 127.244 4.54297C127.674 4.54297 128.062 4.62305 128.41 4.7832C128.758 4.93945 129.057 5.16016 129.307 5.44531C129.557 5.73047 129.748 6.06836 129.881 6.45898C130.014 6.84961 130.08 7.27539 130.08 7.73633V7.92969C130.08 8.39062 130.014 8.81641 129.881 9.20703C129.748 9.59375 129.557 9.92969 129.307 10.2148C129.061 10.5 128.764 10.7227 128.416 10.8828C128.068 11.0391 127.682 11.1172 127.256 11.1172C126.826 11.1172 126.438 11.0391 126.09 10.8828C125.742 10.7227 125.443 10.5 125.193 10.2148C124.943 9.92969 124.752 9.59375 124.619 9.20703C124.486 8.81641 124.42 8.39062 124.42 7.92969ZM125.117 7.73633V7.92969C125.117 8.27734 125.164 8.60742 125.258 8.91992C125.352 9.22852 125.488 9.50391 125.668 9.74609C125.848 9.98438 126.07 10.1719 126.336 10.3086C126.602 10.4453 126.908 10.5137 127.256 10.5137C127.6 10.5137 127.902 10.4453 128.164 10.3086C128.43 10.1719 128.652 9.98438 128.832 9.74609C129.012 9.50391 129.146 9.22852 129.236 8.91992C129.33 8.60742 129.377 8.27734 129.377 7.92969V7.73633C129.377 7.39258 129.33 7.06641 129.236 6.75781C129.146 6.44922 129.01 6.17383 128.826 5.93164C128.646 5.68945 128.424 5.49805 128.158 5.35742C127.893 5.2168 127.588 5.14648 127.244 5.14648C126.9 5.14648 126.596 5.2168 126.33 5.35742C126.068 5.49805 125.846 5.68945 125.662 5.93164C125.482 6.17383 125.346 6.44922 125.252 6.75781C125.162 7.06641 125.117 7.39258 125.117 7.73633ZM132.23 6.01367V11H131.533V4.66016H132.201L132.23 6.01367ZM132.072 7.4375L131.762 7.26172C131.785 6.88672 131.861 6.53516 131.99 6.20703C132.119 5.87891 132.293 5.58984 132.512 5.33984C132.734 5.08984 132.994 4.89453 133.291 4.75391C133.592 4.61328 133.924 4.54297 134.287 4.54297C134.604 4.54297 134.887 4.58594 135.137 4.67188C135.387 4.75781 135.6 4.89453 135.775 5.08203C135.951 5.26953 136.084 5.50977 136.174 5.80273C136.268 6.0957 136.314 6.45312 136.314 6.875V11H135.611V6.86914C135.611 6.43164 135.551 6.08984 135.43 5.84375C135.309 5.59375 135.137 5.41602 134.914 5.31055C134.691 5.20508 134.428 5.15234 134.123 5.15234C133.787 5.15234 133.492 5.22656 133.238 5.375C132.988 5.51953 132.777 5.70898 132.605 5.94336C132.438 6.17383 132.309 6.42188 132.219 6.6875C132.129 6.94922 132.08 7.19922 132.072 7.4375ZM140.527 4.66016V5.23438H137.352V4.66016H140.527ZM138.518 3.03125H139.215V9.45898C139.215 9.75195 139.254 9.97266 139.332 10.1211C139.41 10.2695 139.512 10.3691 139.637 10.4199C139.762 10.4707 139.896 10.4961 140.041 10.4961C140.146 10.4961 140.248 10.4902 140.346 10.4785C140.443 10.4629 140.531 10.4473 140.609 10.4316L140.639 11.0234C140.553 11.0508 140.441 11.0723 140.305 11.0879C140.168 11.1074 140.031 11.1172 139.895 11.1172C139.625 11.1172 139.387 11.0684 139.18 10.9707C138.973 10.8691 138.811 10.6973 138.693 10.4551C138.576 10.209 138.518 9.875 138.518 9.45312V3.03125ZM142.777 4.66016V11H142.08V4.66016H142.777ZM141.957 2.82617C141.957 2.69336 141.998 2.58203 142.08 2.49219C142.166 2.39844 142.283 2.35156 142.432 2.35156C142.58 2.35156 142.697 2.39844 142.783 2.49219C142.873 2.58203 142.918 2.69336 142.918 2.82617C142.918 2.95508 142.873 3.06641 142.783 3.16016C142.697 3.25 142.58 3.29492 142.432 3.29492C142.283 3.29492 142.166 3.25 142.08 3.16016C141.998 3.06641 141.957 2.95508 141.957 2.82617ZM145.391 6.01367V11H144.693V4.66016H145.361L145.391 6.01367ZM145.232 7.4375L144.922 7.26172C144.945 6.88672 145.021 6.53516 145.15 6.20703C145.279 5.87891 145.453 5.58984 145.672 5.33984C145.895 5.08984 146.154 4.89453 146.451 4.75391C146.752 4.61328 147.084 4.54297 147.447 4.54297C147.764 4.54297 148.047 4.58594 148.297 4.67188C148.547 4.75781 148.76 4.89453 148.936 5.08203C149.111 5.26953 149.244 5.50977 149.334 5.80273C149.428 6.0957 149.475 6.45312 149.475 6.875V11H148.771V6.86914C148.771 6.43164 148.711 6.08984 148.59 5.84375C148.469 5.59375 148.297 5.41602 148.074 5.31055C147.852 5.20508 147.588 5.15234 147.283 5.15234C146.947 5.15234 146.652 5.22656 146.398 5.375C146.148 5.51953 145.938 5.70898 145.766 5.94336C145.598 6.17383 145.469 6.42188 145.379 6.6875C145.289 6.94922 145.24 7.19922 145.232 7.4375ZM155.352 9.53516V4.66016H156.055V11H155.381L155.352 9.53516ZM155.48 8.36328L155.844 8.35156C155.844 8.75 155.797 9.11719 155.703 9.45312C155.609 9.78906 155.463 10.082 155.264 10.332C155.064 10.582 154.807 10.7754 154.49 10.9121C154.174 11.0488 153.793 11.1172 153.348 11.1172C153.039 11.1172 152.756 11.0742 152.498 10.9883C152.244 10.8984 152.025 10.7578 151.842 10.5664C151.658 10.375 151.516 10.127 151.414 9.82227C151.316 9.51758 151.268 9.14844 151.268 8.71484V4.66016H151.965V8.72656C151.965 9.06641 152.002 9.34961 152.076 9.57617C152.154 9.80273 152.26 9.98438 152.393 10.1211C152.529 10.2578 152.686 10.3555 152.861 10.4141C153.037 10.4727 153.227 10.502 153.43 10.502C153.945 10.502 154.352 10.4023 154.648 10.2031C154.949 10.0039 155.162 9.74219 155.287 9.41797C155.416 9.08984 155.48 8.73828 155.48 8.36328ZM160.338 11.1172C159.924 11.1172 159.543 11.041 159.195 10.8887C158.852 10.7363 158.551 10.5215 158.293 10.2441C158.039 9.9668 157.842 9.63867 157.701 9.25977C157.564 8.87695 157.496 8.45898 157.496 8.00586V7.75391C157.496 7.26562 157.568 6.82422 157.713 6.42969C157.857 6.03516 158.057 5.69727 158.311 5.41602C158.564 5.13477 158.854 4.91992 159.178 4.77148C159.506 4.61914 159.85 4.54297 160.209 4.54297C160.611 4.54297 160.969 4.61523 161.281 4.75977C161.594 4.90039 161.855 5.10156 162.066 5.36328C162.281 5.62109 162.443 5.92773 162.553 6.2832C162.662 6.63477 162.717 7.02344 162.717 7.44922V7.87695H157.918V7.2793H162.02V7.19727C162.012 6.8418 161.939 6.50977 161.803 6.20117C161.67 5.88867 161.471 5.63477 161.205 5.43945C160.939 5.24414 160.607 5.14648 160.209 5.14648C159.912 5.14648 159.639 5.20898 159.389 5.33398C159.143 5.45898 158.93 5.63867 158.75 5.87305C158.574 6.10352 158.438 6.37891 158.34 6.69922C158.246 7.01562 158.199 7.36719 158.199 7.75391V8.00586C158.199 8.35742 158.25 8.68555 158.352 8.99023C158.457 9.29102 158.605 9.55664 158.797 9.78711C158.992 10.0176 159.223 10.1973 159.488 10.3262C159.754 10.4551 160.047 10.5195 160.367 10.5195C160.742 10.5195 161.074 10.4512 161.363 10.3145C161.652 10.1738 161.912 9.95312 162.143 9.65234L162.582 9.99219C162.445 10.1953 162.273 10.3828 162.066 10.5547C161.863 10.7266 161.619 10.8633 161.334 10.9648C161.049 11.0664 160.717 11.1172 160.338 11.1172ZM168.787 9.51758L170.316 4.66016H170.809L170.516 5.9668L168.916 11H168.424L168.787 9.51758ZM167.199 4.66016L168.541 9.54688L168.828 11H168.318L166.479 4.66016H167.199ZM172.713 9.5293L174.02 4.66016H174.74L172.9 11H172.396L172.713 9.5293ZM170.908 4.66016L172.414 9.47656L172.795 11H172.303L170.668 5.96094L170.393 4.66016H170.908ZM176.867 4.66016V11H176.17V4.66016H176.867ZM176.047 2.82617C176.047 2.69336 176.088 2.58203 176.17 2.49219C176.256 2.39844 176.373 2.35156 176.521 2.35156C176.67 2.35156 176.787 2.39844 176.873 2.49219C176.963 2.58203 177.008 2.69336 177.008 2.82617C177.008 2.95508 176.963 3.06641 176.873 3.16016C176.787 3.25 176.67 3.29492 176.521 3.29492C176.373 3.29492 176.256 3.25 176.17 3.16016C176.088 3.06641 176.047 2.95508 176.047 2.82617ZM181.18 4.66016V5.23438H178.004V4.66016H181.18ZM179.17 3.03125H179.867V9.45898C179.867 9.75195 179.906 9.97266 179.984 10.1211C180.062 10.2695 180.164 10.3691 180.289 10.4199C180.414 10.4707 180.549 10.4961 180.693 10.4961C180.799 10.4961 180.9 10.4902 180.998 10.4785C181.096 10.4629 181.184 10.4473 181.262 10.4316L181.291 11.0234C181.205 11.0508 181.094 11.0723 180.957 11.0879C180.82 11.1074 180.684 11.1172 180.547 11.1172C180.277 11.1172 180.039 11.0684 179.832 10.9707C179.625 10.8691 179.463 10.6973 179.346 10.4551C179.229 10.209 179.17 9.875 179.17 9.45312V3.03125ZM183.348 2V11H182.65V2H183.348ZM183.189 7.4375L182.879 7.26172C182.902 6.88672 182.979 6.53516 183.107 6.20703C183.236 5.87891 183.41 5.58984 183.629 5.33984C183.852 5.08984 184.111 4.89453 184.408 4.75391C184.709 4.61328 185.041 4.54297 185.404 4.54297C185.721 4.54297 186.004 4.58594 186.254 4.67188C186.504 4.75781 186.717 4.89453 186.893 5.08203C187.068 5.26953 187.201 5.50977 187.291 5.80273C187.385 6.0957 187.432 6.45312 187.432 6.875V11H186.729V6.86914C186.729 6.43164 186.668 6.08984 186.547 5.84375C186.426 5.59375 186.254 5.41602 186.031 5.31055C185.809 5.20508 185.545 5.15234 185.24 5.15234C184.904 5.15234 184.609 5.22656 184.355 5.375C184.105 5.51953 183.895 5.70898 183.723 5.94336C183.555 6.17383 183.426 6.42188 183.336 6.6875C183.246 6.94922 183.197 7.19922 183.189 7.4375Z"
      fill="#BBBBBB"
    />
  </svg>
);

const LoginWithButton = styled.button`
  background: #ffffff;
  box-shadow: -4px 4px 12px rgba(0, 0, 0, 0.25);
  border-radius: 8px;
  border: none;
  display: flex;
  align-items: center;
  // padding: 10px;
  width: 100%;
  margin-top: 16px;
  cursor: pointer;
`;

const LoginWithText = styled.p`
  font-family: "Roboto";
  font-weight: regular;
  font-size: 14px;
  display: flex;
  color: #000000;
  margin-left: 24px;
`;

const LoginWithWrapper = styled.div`
  display: flex;
  align-items: center;
  justify-content: center;
`;

export default LoginForm;
